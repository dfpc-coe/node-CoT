import test from 'tape';
import { CoTParser } from '../index.js';

test('Parse u-d-c-c (Transparent)', async (t) => {
    const cot = CoTParser.from_xml(`
        <event
          version='2.0'
          uid='32c312f0-e146-42ee-86b3-ad357d1b76fd'
          type='u-d-c-c'
          time='2026-02-13T18:08:22.479Z'
          start='2026-02-13T18:08:22.479Z'
          stale='2026-02-14T18:08:22.479Z'
          how='h-e'
          access='Undefined'
        >
          <point
            lat='38.9456255'
            lon='-108.5333539'
            hae='1717.419'
            ce='9999999.0'
            le='9999999.0'
          />
          <detail>
            <shape>
              <ellipse
                major='2535.9708862816324'
                minor='2535.9708862816324'
                angle='360'
              />
              <link
                uid='32c312f0-e146-42ee-86b3-ad357d1b76fd.Style'
                type='b-x-KmlStyle'
                relation='p-c'
              >
                <Style>
                  <LineStyle>
                    <color>ffff7700</color>
                    <width>3.0</width>
                  </LineStyle>
                  <PolyStyle>
                    <color>00ff7700</color>
                  </PolyStyle>
                </Style>
              </link>
            </shape>
            <__shapeExtras cpvis='true' editable='true' />
            <remarks />
            <contact callsign='TRANSPARENT' />
            <creator
              uid='ANDROID-764679f74013dfe2'
              callsign='COTAK Ingalls'
              time='2026-02-13T18:06:16.036Z'
              type='a-f-G-E-V-C'
            />
            <strokeColor value='-35072' />
            <strokeWeight value='3.0' />
            <strokeStyle value='solid' />
            <fillColor value='16742144' />
            <precisionlocation altsrc='DTED2' />
            <labels_on value='true' />
            <archive />
          </detail>
        </event>
    `);

    t.deepEquals(await CoTParser.to_geojson(cot), {
        id: '32c312f0-e146-42ee-86b3-ad357d1b76fd',
        type: 'Feature', 
        properties: { 
            callsign: 'TRANSPARENT', 
            center: [ -108.5333539, 38.9456255, 1717.419 ], 
            type: 'u-d-c-c', 
            how: 'h-e', 
            time: '2026-02-13T18:08:22.479Z', 
            start: '2026-02-13T18:08:22.479Z', 
            stale: '2026-02-14T18:08:22.479Z', 
            creator: { 
                uid: 'ANDROID-764679f74013dfe2', 
                callsign: 'COTAK Ingalls', 
                time: '2026-02-13T18:06:16.036Z', 
                type: 'a-f-G-E-V-C' 
            }, 
            labels: true, 
            archived: true, 
            precisionlocation: { 
                altsrc: 'DTED2' 
            }, 
            stroke: '#FFFF77', 
            'stroke-opacity': 0, 
            'stroke-width': 3, 
            'stroke-style': 'solid', 
            'fill-opacity': 0, 
            fill: '#00FF77', 
            shape: { 
                ellipse: { 
                    major: 2535.9708862816324, 
                    minor: 2535.9708862816324, 
                    angle: 360 
                } 
            }, 
            metadata: {} 
        }, 
        geometry: { 
            type: 'Polygon', 
            coordinates: [ [ 
                [ -108.562678, 38.945622, 1717.419 ], 
                [ -108.562538, 38.947857, 1717.419 ], 
                [ -108.562116, 38.950071, 1717.419 ], 
                [ -108.561418, 38.952243, 1717.419 ], 
                [ -108.560449, 38.95435, 1717.419 ], 
                [ -108.559219, 38.956374, 1717.419 ], 
                [ -108.55774, 38.958294, 1717.419 ], 
                [ -108.556026, 38.960092, 1717.419 ], 
                [ -108.554094, 38.96175, 1717.419 ], 
                [ -108.551961, 38.963254, 1717.419 ], 
                [ -108.54965, 38.964587, 1717.419 ], 
                [ -108.547181, 38.965738, 1717.419 ], 
                [ -108.544579, 38.966695, 1717.419 ], 
                [ -108.541869, 38.96745, 1717.419 ], 
                [ -108.539077, 38.967994, 1717.419 ], 
                [ -108.536229, 38.968322, 1717.419 ], 
                [ -108.533354, 38.968432, 1717.419 ], 
                [ -108.530479, 38.968322, 1717.419 ], 
                [ -108.527631, 38.967994, 1717.419 ], 
                [ -108.524839, 38.96745, 1717.419 ], 
                [ -108.522129, 38.966695, 1717.419 ], 
                [ -108.519527, 38.965738, 1717.419 ], 
                [ -108.517058, 38.964587, 1717.419 ], 
                [ -108.514746, 38.963254, 1717.419 ], 
                [ -108.512614, 38.96175, 1717.419 ], 
                [ -108.510682, 38.960092, 1717.419 ], 
                [ -108.508968, 38.958294, 1717.419 ], 
                [ -108.507489, 38.956374, 1717.419 ], 
                [ -108.506259, 38.95435, 1717.419 ], 
                [ -108.50529, 38.952243, 1717.419 ], 
                [ -108.504592, 38.950071, 1717.419 ], 
                [ -108.50417, 38.947857, 1717.419 ], 
                [ -108.50403, 38.945622, 1717.419 ], 
                [ -108.504172, 38.943386, 1717.419 ], 
                [ -108.504595, 38.941173, 1717.419 ], 
                [ -108.505295, 38.939002, 1717.419 ], 
                [ -108.506265, 38.936895, 1717.419 ], 
                [ -108.507496, 38.934872, 1717.419 ], 
                [ -108.508976, 38.932952, 1717.419 ], 
                [ -108.510691, 38.931155, 1717.419 ], 
                [ -108.512623, 38.929497, 1717.419 ], 
                [ -108.514756, 38.927994, 1717.419 ], 
                [ -108.517067, 38.926661, 1717.419 ], 
                [ -108.519535, 38.925511, 1717.419 ], 
                [ -108.522135, 38.924555, 1717.419 ], 
                [ -108.524844, 38.923801, 1717.419 ], 
                [ -108.527635, 38.923257, 1717.419 ], 
                [ -108.530481, 38.922929, 1717.419 ], 
                [ -108.533354, 38.922819, 1717.419 ], 
                [ -108.536227, 38.922929, 1717.419 ], 
                [ -108.539073, 38.923257, 1717.419 ], 
                [ -108.541864, 38.923801, 1717.419 ], 
                [ -108.544572, 38.924555, 1717.419 ], 
                [ -108.547173, 38.925511, 1717.419 ], 
                [ -108.549641, 38.926661, 1717.419 ], 
                [ -108.551952, 38.927994, 1717.419 ], 
                [ -108.554084, 38.929497, 1717.419 ], 
                [ -108.556017, 38.931155, 1717.419 ], 
                [ -108.557732, 38.932952, 1717.419 ], 
                [ -108.559211, 38.934872, 1717.419 ], 
                [ -108.560442, 38.936895, 1717.419 ], 
                [ -108.561413, 38.939002, 1717.419 ], 
                [ -108.562113, 38.941173, 1717.419 ], 
                [ -108.562536, 38.943386, 1717.419 ], 
                [ -108.562678, 38.945622, 1717.419 ] 
            ] ] 
        },
        path: '/'
    });

    t.end();
});

